pipeline {
    agent any
    stages {
        stage("Variables") {
            steps {
                sh "printenv"
            }
        }
        stage("Version Check") {
            steps {
                sh "node --version"
                sh "npm --version"
                sh "git --version"
            }
        }
        stage("Lint commit") {
            steps {
                sh "npm run lint:commit"
            }
        }
        stage("npm install") {
            steps {
                sh "npm ci"
            }
        }
        stage("Publish help") {
            steps {
                sh "npm run release:help"
            }
        }
        stage('Publish') {
            when {
                not {
                    tag 'v*'
                }
            }
            environment {
                NPM_TOKEN=credentials('NPM_TOKEN')
                GITHUB_TOKEN=credentials('GITHUB_TOKEN')
            }
            steps {
                sh "npm run release"
            }
        }
    }
}